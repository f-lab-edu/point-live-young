# ADR-004: Entity <-> DTO 매핑 전략
---

## Status
---  
Accepted

## Context
---
Spring JPA 환경에서 Entity class 와 DTO class 간 변환을 어떻게 할지에 대한 논의이다.

- Entity Class 
    - 역할 : DB와 매핑하는 도메인 모델, 비즈니스 규칙과 무결성을 보장한다.
- DTO Class
    - 역할 : API Request/Response 에 맞게 데이터를 전달하는 계층간 전송 객체이다.

**Entity와 DTO가 서로 직접 의존하면 결합도가 높아지고, 단일 책임 원칙(SRP)을 위반할 위험이 있다. 이를 방지하기 위해 다양한 매핑 전략을 고려했다.**

<br/>

**고려대안**

**1. Service Layer 에서 직접 변환 한다.**
- 장점 : Entity 와 DTO는 서로를 모르고 Service에서만 책임을 가진다.
- 단점 : Service 에 비즈니스 로직 + 매핑 로직이 뒤섞여서 책임이 증가한다.
- 그리고 결국 각 entity, dto class 마다 생성자를 두는데 서로에 맞춰서 생성자가 생겨서 결국 결합도가 올라간다.

**2. Entity 클래스에서 모든 매핑을 한다.**
- 장점 : 변환 코드가 Entity 클래스에 응집된다.
- 단점 : Entity Class 는 DTO Class에 의존하게 되어서 결국 SRP에 위배된다.

**3. Entity Class 와 DTO Class 사이에 매핑하는 Class을 둔다.**

	- a : 전용 매퍼 클래스를 만든다. (수동 매핑)
		- 장점 : 명시적이고 테스트 용이하고 라이브러리 의존이 없다.
		- 단점 : 해당 매퍼 클래스에 반복적인 코드가 많아진다, 보일러플레이트 증가
	- b : MapStruct  같은 매퍼 라이브러리를 사용한다
		- 장점 : 반복적인 매핑 코드가 제거된다.
		- 단점 : 외부 라이브러리 의존, 해당 라이브러리를 쓰기 위한 추가 학습 비용도 생김

## Decision
---

- Entity와 DTO 매핑 전략으로 전용 매퍼 클래스 (수동 매핑)을 채택한다.
    - 각 도메인 단위 매퍼를 관리한다.
    - (컨트롤러 - 서비스) 간에는 DTO을 사용, (서비스 - 레포지토리) 간에는 Entity 사용.
    - 변환 과정에서 필요한 정책은 매퍼 클래스에서 처리한다.

## Consequences
---
장점
    - SRP 준수 : Entity와 DTO 간 결합 제거
    - 매핑 로직이 전용 클래스에 모여서 명확하다
    - 예측 가능한 매핑

단점 
- 보일러플레이트 증가

이후 고려할 점
- 대규모 리스트 변환, 프로젝트 규모가 커져서 매핑해야할 객체들이 많아지면 MapStruct 도입